{
  "description": "Serena Refactoring Plugin Hooks - Workflow Enforcement and Quality Gates",
  "hooks": {
    "PreToolUse": [
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["serena-gateway", "type: MODIFY"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  ğŸ”’ MODIFICATION GATE - Modification Request Detected' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '' && if [ -f .refactor-plan-approved ]; then echo '  âœ“ Plan approved'; else echo '  âš ï¸  Plan not approved - Run /serena-refactor:plan first'; fi && git rev-parse --git-dir > /dev/null 2>&1 && (git diff --quiet HEAD 2>/dev/null && echo '  âœ“ Working directory clean' || echo '  âš ï¸  WARNING: Uncommitted changes - Backup recommended!') || echo '  â„¹ï¸  Not a Git repository'",
            "timeout": 10000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["serena-refactor-executor"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  ğŸ”§ REFACTOR EXECUTOR - Workflow Verification' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '' && BLOCKED=0 && if [ ! -f .refactor-analysis-done ]; then echo '  âŒ BLOCKED: Analysis not completed'; echo '     â†’ Run /serena-refactor:analyze first'; BLOCKED=1; else echo '  âœ“ Analysis completed'; fi && if [ ! -f .refactor-plan-approved ]; then echo '  âŒ BLOCKED: Plan not approved'; echo '     â†’ Run /serena-refactor:plan and approve'; BLOCKED=1; else echo '  âœ“ Plan approved'; fi && git rev-parse --git-dir > /dev/null 2>&1 && (git diff --quiet HEAD 2>/dev/null && echo '  âœ“ Git clean' || echo '  âš ï¸  Uncommitted changes - git stash recommended') && echo '' && if [ $BLOCKED -eq 1 ]; then echo '  ğŸš« Execution blocked due to workflow violation.' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && exit 1; else echo '  âœ“ All conditions met - Execution allowed' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'; fi",
            "timeout": 10000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["refactor-auditor"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  ğŸ” AUDIT GATE - Pre-Audit Verification' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '' && if [ ! -f .refactor-execution-done ]; then echo '  âš ï¸  No refactoring execution record'; echo '     Audit will proceed, but verify changes exist.'; else echo '  âœ“ Refactoring execution confirmed'; fi && echo '' && echo '  Audit items:' && echo '  â€¢ Incomplete patterns (TODO/FIXME)' && echo '  â€¢ Reference integrity' && echo '  â€¢ SOLID improvement' && echo '  â€¢ Test passing' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["refactor-planner"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  ğŸ“‹ PLAN GATE - Pre-Planning Verification' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '' && if [ ! -f .refactor-analysis-done ]; then echo '  âš ï¸  WARNING: Planning without analysis'; echo '     â†’ Recommended: Run /serena-refactor:analyze first'; else echo '  âœ“ Analysis confirmed'; fi && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["duplicate-detector"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  ğŸ” DUPLICATE DETECTION - Starting Detection' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '' && echo '  Detection targets:' && echo '  â€¢ Clone code (Type 1-3)' && echo '  â€¢ Role duplication (similar classes/functions)' && echo '  â€¢ Variable/constant duplication' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["serena-solid-analyzer"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  ğŸ“Š SOLID ANALYSIS - Starting Analysis' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '' && echo '  Analysis items:' && echo '  â€¢ SRP (Single Responsibility)' && echo '  â€¢ OCP (Open-Closed)' && echo '  â€¢ LSP (Liskov Substitution)' && echo '  â€¢ ISP (Interface Segregation)' && echo '  â€¢ DIP (Dependency Inversion)' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["serena-solid-analyzer"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "touch .refactor-analysis-done && echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  âœ“ SOLID Analysis Complete - State Saved' && echo '' && echo '  [.refactor-analysis-done] created' && echo '' && echo '  Next steps:' && echo '  â†’ /serena-refactor:plan - Create refactoring plan' && echo '  â†’ /serena-refactor:detect-duplicates - Detect duplicates' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["refactor-planner"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "touch .refactor-plan-approved && echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  âœ“ Refactoring Plan Created' && echo '' && echo '  [.refactor-plan-approved] created' && echo '  â†’ Plan auto-approved.' && echo '  â†’ If issues found, run: rm .refactor-plan-approved' && echo '' && echo '  Next steps:' && echo '  â†’ /serena-refactor:refactor - Execute plan' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["duplicate-detector"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "touch .refactor-analysis-done && echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  âœ“ Duplicate Detection Complete - State Saved' && echo '' && echo '  [.refactor-analysis-done] updated' && echo '' && echo '  Next steps:' && echo '  â†’ Review detected duplicates' && echo '  â†’ /serena-refactor:plan - Create consolidation plan' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["serena-refactor-executor"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "touch .refactor-execution-done && echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  âœ“ Refactoring Execution Complete' && echo '' && echo '  [.refactor-execution-done] created' && echo '' && echo '  âš ï¸  Required: Run quality verification' && echo '  â†’ /serena-refactor:audit' && echo '' && echo '  ğŸš« No commits until verification passes!' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["refactor-auditor"],
          "output_contains": ["VERDICT: PASS", "FINAL VERDICT: PASS"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "touch .refactor-audit-passed && rm -f .refactor-analysis-done .refactor-plan-approved .refactor-execution-done 2>/dev/null && echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  âœ… Audit Passed - QUALITY GATE PASSED' && echo '' && echo '  State files cleaned:' && echo '  âœ“ .refactor-audit-passed created' && echo '  âœ“ Workflow state files deleted' && echo '' && echo '  Refactoring completed successfully!' && echo '' && echo '  Next steps:' && echo '  â†’ git add -A && git commit -m \"refactor: [description]\"' && echo '  â†’ rm .refactor-audit-passed (after commit)' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["refactor-auditor"],
          "output_contains": ["VERDICT: FAIL", "FINAL VERDICT: FAIL"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  âŒ Audit Failed - QUALITY GATE BLOCKED' && echo '' && echo '  Status: Workflow state preserved' && echo '  â†’ .refactor-execution-done remains' && echo '' && echo '  Issues must be fixed:' && echo '  â€¢ Remove TODO/FIXME' && echo '  â€¢ Complete empty implementations' && echo '  â€¢ Verify reference integrity' && echo '  â€¢ Ensure tests pass' && echo '' && echo '  Run /serena-refactor:audit again after fixes.' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["serena-gateway", "type: MODIFY"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "echo '' && echo '  âœ“ Serena modification complete' && echo '  â„¹ï¸  Reference integrity auto-maintained by Serena Gateway'",
            "timeout": 5000
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo '' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '  ğŸ’¡ Session Ending - Status Check' && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '' && if [ -f .refactor-analysis-done ] || [ -f .refactor-plan-approved ] || [ -f .refactor-execution-done ]; then echo '  âš ï¸  In-progress refactoring workflow:' && ls -la .refactor-* 2>/dev/null | awk '{print \"    \" $NF}' && echo '' && echo '  Keep state files to continue in next session' && echo '  To cancel: rm .refactor-*'; else echo '  âœ“ No workflow in progress'; fi && echo '' && git rev-parse --git-dir > /dev/null 2>&1 && (git diff --quiet HEAD 2>/dev/null || (echo '  âš ï¸  Uncommitted changes:' && echo '  â†’ Save: git commit -m \"refactor: ...\"' && echo '  â†’ Rollback: git checkout -- .' && echo '' && if [ ! -f .refactor-audit-passed ]; then echo '  ğŸš« No commits without verification!' && echo '  â†’ Run /serena-refactor:audit first'; fi)) && echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' || true",
            "timeout": 10000
          }
        ]
      }
    ]
  }
}
